# Local Testing Guide

This guide shows you how to test the `@ai-observability/client` package in your local projects without publishing it to npm.

## Method 1: Using `npm link` (Recommended for Development)

This creates a symlink so changes in the package are immediately available in your project.

### Step 1: Build and Link the Package

```bash
# Navigate to the package directory
cd packages/observability-client

# Install dependencies (if not already done)
npm install

# Build the package
npm run build

# Create a global symlink
npm link
```

### Step 2: Link in Your Project

```bash
# Navigate to your project directory
cd /path/to/your/project

# Link the package
npm link @ai-observability/client
```

### Step 3: Use in Your Project

```typescript
import { initObservability, trackEvent, TrackedButton } from '@ai-observability/client';

// Initialize
initObservability({
  serviceUrl: 'http://localhost:8006',
  serviceName: 'my-app',
});

// Use it
await trackEvent('test_event', { test: true });
```

### Step 4: Watch Mode (Optional)

If you want changes to automatically rebuild:

```bash
# In the package directory, run in watch mode
cd packages/observability-client
npm run dev
```

Then in another terminal, your project will automatically pick up changes.

### Unlinking

When you're done testing:

```bash
# In your project
npm unlink @ai-observability/client

# In the package directory (optional)
npm unlink
```

---

## Method 2: Using `file:` Protocol (Simple, No Global Links)

This method directly references the local package directory.

### Step 1: Build the Package

```bash
cd packages/observability-client
npm install
npm run build
```

### Step 2: Install in Your Project

In your project's `package.json`, add:

```json
{
  "dependencies": {
    "@ai-observability/client": "file:../path/to/packages/observability-client"
  }
}
```

Or if your project is in the same repo:

```json
{
  "dependencies": {
    "@ai-observability/client": "file:../../packages/observability-client"
  }
}
```

Then run:

```bash
npm install
```

### Step 3: Use in Your Project

Same as Method 1 - import and use normally.

**Note:** After making changes to the package, you need to:
1. Rebuild: `cd packages/observability-client && npm run build`
2. Restart your dev server in your project

---

## Method 3: Using `npm pack` (Tarball)

This creates a tarball that you can install like a published package.

### Step 1: Create Tarball

```bash
cd packages/observability-client
npm install
npm run build
npm pack
```

This creates a file like `ai-observability-client-1.0.0.tgz`

### Step 2: Install in Your Project

```bash
cd /path/to/your/project
npm install /path/to/packages/observability-client/ai-observability-client-1.0.0.tgz
```

Or add to `package.json`:

```json
{
  "dependencies": {
    "@ai-observability/client": "file:../path/to/packages/observability-client/ai-observability-client-1.0.0.tgz"
  }
}
```

---

## Quick Setup Script

For convenience, you can use this script:

```bash
#!/bin/bash
# Link script: link-package.sh

cd "$(dirname "$0")"
npm install
npm run build
npm link
echo "âœ… Package linked! Now run 'npm link @ai-observability/client' in your project"
```

---

## Testing in the Current Frontend Project

To test in the existing frontend project in this repo:

### Option A: Use file: protocol

1. Update `frontend/package.json`:

```json
{
  "dependencies": {
    "@ai-observability/client": "file:../packages/observability-client"
  }
}
```

2. Install:

```bash
cd frontend
npm install
```

3. Update `frontend/src/main.tsx` to use the package:

```typescript
import { initObservability } from '@ai-observability/client';

// Initialize observability
initObservability({
  serviceUrl: import.meta.env.VITE_OBSERVABILITY_SERVICE_URL || 'http://localhost:8006',
  serviceName: 'observability-demo-frontend',
  autoTrack: {
    pageViews: true,
    errors: true,
    apiErrors: true,
  },
});
```

### Option B: Use npm link

```bash
# Terminal 1: Build and link package
cd packages/observability-client
npm install
npm run build
npm link

# Terminal 2: Link in frontend
cd frontend
npm link @ai-observability/client
```

---

## Troubleshooting

### Issue: Module not found
- Make sure you've built the package: `npm run build`
- Check that `dist/` folder exists with compiled files
- Restart your dev server

### Issue: TypeScript errors
- Make sure `dist/index.d.ts` exists (should be generated by build)
- Check `tsconfig.json` includes the package

### Issue: Changes not reflected
- Rebuild the package: `npm run build`
- Restart your dev server
- Clear node_modules and reinstall if using `file:` protocol

### Issue: React version mismatch
- The package uses React as a peer dependency
- Make sure your project has React installed
- Check React versions are compatible (>=16.8.0)

---

## Development Workflow

1. Make changes to package source in `src/`
2. Run `npm run build` (or `npm run dev` for watch mode)
3. Changes are automatically available if using `npm link`
4. If using `file:` protocol, restart your project's dev server
